[comment encoding = UTF-8 /]
[module index('http://www.eclipse.org/uml2/5.0.0/UML')]
[import ::utils /]

[template public indexMain(m : Model, path : String)]
[m.appjs(path.concat('src/'))/]
[m.index(path)/]
[/template]

[template protected appjs(m : Model, path : String)]
[file (path.concat('app.js'), false, 'UTF-8')]
(function (ng) {

    var mainApp = ng.module('mainApp', ['['/]
        //'MockModule',
        [for (c : Class | m.getRootClasses())] 
        '[c.getModule()/]',
        [if (c.isMaster())]
        '[c.getMasterModule()/]',
        [else]
        '[c.getModule()/]',
        [/if]
        [/for]
        'ngRoute'
    [']'/]);

    mainApp.config(['['/]'$routeProvider', function ($routeProvider) {
            var crudTpl = 'src/shared/crud/crud.tpl.html';
            var crudCtrl = 'ctrl';
            $routeProvider
                [for (c : Class | m.getRootClasses())]
                [if (c.isMaster())]
                .when('/[c.getName()/]', {
                    templateUrl: 'src/modules/[c.getName()/]/[c.getName()/].tpl.html',
                    controller: '[c.getMasterController()/]',
                    controllerAs: crudCtrl
                })
                [else]
                .when('/[c.getName()/]', {
                    templateUrl: crudTpl,
                    controller: '[c.getCtrl()/]',
                    controllerAs: crudCtrl
                })
                [/if]
                [/for]
                .otherwise('/');
        }[']'/]);
})(window.angular);
[/file]
[/template]

[template protected index(m : Model, path : String)]
[file (path.concat('index.html'), false, 'UTF-8')]
<!DOCTYPE html>
<html ng-app="mainApp">
    <head>
        <title>[m.name/]</title>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <link href="https://bootswatch.com/lumen/bootstrap.min.css" rel="stylesheet" type="text/css"/>
        <script src="https://code.jquery.com/jquery-1.11.2.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.8.3/underscore-min.js"></script>
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>
        <script src="https://code.angularjs.org/1.3.13/angular.min.js"></script>
        <script src="https://code.angularjs.org/1.3.13/angular-mocks.js"></script>
        <script src="https://code.angularjs.org/1.3.13/angular-route.min.js"></script>
        <script src="https://code.angularjs.org/1.3.13/angular-cookies.min.js"></script>
        <script src="https://angular-ui.github.io/bootstrap/ui-bootstrap-tpls-0.12.1.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/restangular/1.4.0/restangular.min.js"></script>

        <script src="src/app.js"></script>
        <script src="src/shared/auth/auth.mod.js" type="text/javascript"></script>
        <script src="src/shared/auth/auth.svc.js" type="text/javascript"></script>
        <script src="src/shared/auth/auth.ctrl.js" type="text/javascript"></script>

        <script src="src/shared/crud/crud.mod.js"></script>
        <script src="src/shared/crud/crud.svc.js"></script>
        <script src="src/shared/crud/crud.dir.js"></script>
        <script src="src/shared/crud/crud.ctrl.js"></script>

        <script src="src/shared/mocks/mock.mod.js"></script>

        <script src="src/shared/master/master.mod.js"></script>
        <script src="src/shared/master/master.svc.js"></script>

        [for (c : Class | m.getClasses())]
        <script src="src/modules/[c.getName()/]/[c.getName()/].mod.js"></script>
        [if (not c.isChild())]
        <script src="src/modules/[c.getName()/]/[c.getName()/].svc.js"></script>
        <script src="src/modules/[c.getName()/]/[c.getName()/].ctrl.js"></script>
        [/if]

        [/for]
    </head>
    <body style="padding-top: 60px;">
        <div class="container">
            <div class="col-md-12">
                <nav class="navbar navbar-default navbar-fixed-top" role="navigation">
                    <div class="container-fluid">
                        <!-- Brand and toggle get grouped for better mobile display -->
                        <div class="navbar-header">
                            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#main-bar">
                                <span class="sr-only">Toggle navigation</span>
                                <span class="icon-bar"></span>
                                <span class="icon-bar"></span>
                                <span class="icon-bar"></span>
                            </button>
                            <a class="navbar-brand" href>[m.name/]</a>
                        </div>

                        <!-- Collect the nav links, forms, and other content for toggling -->
                        <div class="collapse navbar-collapse" id="main-bar">
                            <ul class="nav navbar-nav navbar-right">
                                <li ng-controller="authCtrl">
                                    <a ng-if="isAuthenticated">User</a>
                                    <a ng-if="!isAuthenticated">Login</a>
                                </li>
                            </ul>
                        </div> <!-- /.navbar-collapse -->
                    </div> <!-- /.container-fluid -->
                </nav>
            </div>
            <div class="col-md-2 well">
                <ul class="nav nav-pills nav-stacked">
				[for (c : Class | m.getRootClasses())]
                [if (c.isMaster())]
                    <li><a href="#/[c.getName()/]">[c.getDisplayName()/] Master</a></li>
                [else]
                    <li><a href="#/[c.getName()/]">[c.getDisplayName()/]</a></li>
                [/if]
				[/for]
                </ul>
            </div>
            <div class="col-md-10">
                <div ng-view></div>
            </div>
        </div>
    </body>
</html>
[/file]
[/template]